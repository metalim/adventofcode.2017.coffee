{_log,_print,assert} = require './util'
ansi = require('ansicolor').nice

input = '''
.
                           |                                                                                                                                                                             
       +-------------------|---+   +-------------------------------------------------------------------------+     +---------+       +-----+       +-----------------------------------------+ +---+     
       |                   |   |   |                                                                         |     |         |       |     |       |                                         | |   |     
   +-+ |                   |   |   |           +-------------+     +-----------------+       +---------------------------------------|-------------------------------------------------------|-----|-+   
   | | |                   |   |   |           |             |     |                 |       |               |     |         |       |     |       |                                         | |   | |   
   | | |                   |   |   |         +-+             |     +-------------------------|---------------|-----------------------|-----|-------|-----------------------+         +-------------+ |   
   | | |                   |   |   |         |               |                       |       |               |     |         |       |     |       |                       |         |       | |     |   
   | +-|-------+           |   |   +---------------------------------+   +-----------|-----------+   +-------------|---------|-------|-----|-------+                       |     +-------------|---+ |   
   |   |       |           |   |             |               |       |   |           |       |   |   |       |     |         |       |     |                               |     |   |       | |   | |   
   |   |   +---------------|---|-------------|---------------------------------------------------|-+ |     +-------|---------+       |     |                               |     |   |       | |   | |   
   |   |   |   |           |   |             |               |       |   |           |       |   | | |     | |     |                 |     |                               |     |   |       | |   | |   
   |   |   |   |           |   |             |               |       |   |           | +---------+ | |     +-------|-----------------|-----------------+                   |     +-------+ +---+   | |   
   |   |   |   |           |   |             |               |       |   |           | |     |     | |       |     |                 |     |           |                   |         |   | | |     | |   
   |   |   |   |       +---|-----------------|-----------------------|---------------|-------|-+ +-|---------|-----------------------------|-------------------------------+ +-------+   | | |     | |   
   |   |   |   |       |   |   |             |               |       |   |           | |     B | | | |       |     |                 |     |           |                     |           | | |     | |   
   +---|-----+ +---------------|-------------|---------------|-----+ |   |           | |     | | | | |       |     |                 |     |           |                     |           | | |     | |   
       |   | |         |   |   |             |               |     | |   |           | |     | | | | |       |     |                 |     |           |                     |           | | |     | |   
 +-----------+         |   |   |             |               |     | |   |           | |     | | | | +-------|-----------------------+     |           |                     |           | +-|---------+ 
 |     |   |           |   |   |             |               |     | |   |           | |     | | | |         |     |                       |           |                     |           |   |     | | | 
 |     |   | +---------|---|-----------------|---------------|-------|---------------|-------|-----|---------------------------------+     |       +---|-----------+         |           |   |     | | | 
 |     |   | |         |   |   |             |               |     | |   H           | |     | | | |         |     |                 |     |       |   |           |         |           |   |     | | | 
 |     |   | |         |   |   | +-----------------------------------|---------------------------|-|---------------------------------------------------------------|-----------------+   |   |     | | | 
 |     |   | |         |   |   | |           |               |     | |   |           | |     | | | |         |     |                 |     |       |   |           |         |       |   |   |     | | | 
 | +-+ |   | |     +-----------|-+           |               |     | |   |           | |     | | | |         |     |                 |     |       |   |           |         |       |   |   |     | | | 
 | | | |   | |     |   |   |   |             |               |     | |   |           | |     | | | |         |     |                 |     |       |   |           |         |       |   |   |     | | | 
 | | | |   | |     |   |   |   | +-+         |               |     | |   |           | |     | | | |         |     |                 |     |       |   |         +-+ +---------------|---|-----+ +-----+ 
 | | | |   | |     |   |   |   | | |         |               |     | |   |           | |     | | | |         |     |                 |     |       |   |         |   |       |       |   |   | | | | |   
 | | | |   | |     +-+ |   |   | | |         | +-------------|----------Z|-------------------|-|-|-----------|-----|-------------+   |     |       |   |         |   |       |       |   |   | | | | |   
 | | | |   | |       | |   |   | | |         | |             |     | |   |           | |     | | | |         |     |             |   |     |       |   |         |   |       |       |   |   | | | | |   
 | | | |   | |       | |   |   | | |         | |             |     | |   |           | |     | | | |         |     |             |   |     |       |   |         |   |       |       |   |   | | | | |   
 | | | |   | |       | |   |   | | |         | |             |     | |   |           | |     | | | |         |     |             |   |     |       |   |         |   |       |       |   |   | | | | |   
 | | | |   | |   +---|-----|---|-|-|-------+ | |             |     | |   |           | |     | | | +---------|-------------------|---|-------+     |   |         |   |       |       |   |   | | | | |   
 | | | |   | |   |   | |   |   | | |       | | |             |     | |   |           | |     | | |           |     |             |   |     | |     |   |         |   |       |       |   |   | | | | |   
 | | | |   | |   |   | | +-|---|---+       | | |           +-------|-|---------------|-------|---|-----------|-----------------------|-----|-|-----|-------------------------------------|---|---|-----+ 
 | | | |   | |   |   | | | |   | |         | | |           | |     | |   |           | |     | | |           |     |             |   |     | |     |   |         |   |       |       |   |   | | | | | | 
 | | | |   | | +-|---|-|-------|-|-----------|---------+   | | +-----|-+ |           | |     | | |           |     |             |   |     | |     |   |         |   |       |       |   |   | | | | | | 
 | | | |   | | | |   | | | |   | |         | | |       |   | | |   | | | |           | |     | | |           |     |             |   |     | |     |   |         |   |       |       |   |   | | | | | | 
 | | | |   | | | |   | | | |   | | +-------|-+ |       |   | | |   | +---|-------------|-----|-|-------------|-------------------|-+ |     | |     |   |         |   |       |       |   |   | | | | | | 
 | | | |   | | | |   | | | |   | | |       |   |       |   | | |   |   | |           | |     | | |           |     |             | | |     | |     |   |         |   |       |       |   |   | | | | | | 
 | | | |   | | | |   | | | |   | +-+       |   |       |   | | |   +---|-|-----------|-------|-|-|-----------------|---------+   | | |     | |     |   |         |   |       |       |   |   | | | | | | 
 | | | |   | | | |   | | | |   |           |   |       |   | | |       | |           | |     | | |           |     |         |   | | |     | |     |   |         |   |       |       |   |   | | | | | | 
 | | | |   | | | +-----|-|-----|---------------|-------|-+ | | |     +-|-|-----------|-------|-+ |         +-|---------------------|-|-----|-------|-------------|-+ |       |       |   |   | | | | | | 
 | | | |   | | |     | | | |   |           |   |       | | | | |     | | |           | |     |   |         | |     |         |   | | |     | |     |   |         | | |       |       |   |   | | | | | | 
 | | | |   | | |     | | | |   |           |   |       | | | | |     | | |           | |     |   | +---------|-+ +-------+   |   | | |     | |     | +-|---------+ | |       |       |   |   | | | | | | 
 | | | |   | | |     | | | |   |           |   |       | | | | |     | | |           | |     |   | |       | | | | |     |   |   | | |     | |     | | |           | |       |       |   |   | | | | | | 
 | | | |   | | |     | | | |   |   +-----+ |   |   +-----|-|---------|-|---------------------|-------+     | | | | |     |   |   | | |     | |     | | |           | |       |       |   |   | | | +---+ 
 | | | |   | | |     | | | |   |   |     | |   |   |   | | | | |     | | |           | |     |   | | |     | | | | |     |   |   | | |     | |     | | |           | |       |       |   |   | | |   |   
 | | | |   | | |     | +-|-|---|---|-----|-------------------|-|-----|---------------|-|-------+ | | |     | | | | |     |   |   | | |     | |     | | |           | | +-------------|-+ |   | | |   |   
 | | | |   | | |     |   | |   |   |     | |   |   |   | | | | |     | | |           | |     | | | | |     | | | | |     |   |   | | |     | |     | | |           | | |     |       | | |   | | |   |   
 | | | +---|---|-+   +---|-|---|---|-------+   |   |   | +-|-|-------------+   +-----|-|---------|---+     | | | | |     |   |   | | |     | |     | | |           | | |     |       | | |   | | |   |   
 | | |     | | | |       | |   |   |     |     |   |   |   | | |     | | | |   |     | |     | | | |       | | | | |     |   |   | | |     | |     | | |           | | |     |       | | |   | | |   |   
 | | |     | | | |     +-|---------|---------------|-------|---------|-|-|-|---|-----|---------|-----------|---|-|-|-----|---+   | | |     | |     | | |           | | |     |       | | |   | | |   |   
 | | |     | | | |     | | |   |   |     |     |   |   |   | | |     | | | |   |     | |     | | | |       | | | | |     |       | | |     | |     | | |           | | |     |       | | |   | | |   |   
 | | |     | +-|---------|-|---|---------|---------------------|-----------|---|-----|-|-----|---|-----------------|-----|---------|-|-----|-+     | | |           | | |     |       | | |   | | |   |   
 | | |     |   | |     | | |   |   |     |     |   |   |   | | |     | | | |   |     | |     | | | |       | | | | |     |       | | |     |       | | |           | | |     |       | | |   | | |   |   
 | | |     |   | |     | +---+ |   |     |     |   |   | +-----|-----|-|-|-|-----------------|-|-|---------|-|-|-|-|-----|-------|-|-|-----|-+     | | |           | | |     |       | | |   | | |   |   
 | | |     |   | |     |   | | |   |     |     |   |   | | | | |     | | | |   |     | |     | | | |       | | | | |     |       | | |     | |     | | |           | | |     |       | | |   | | |   |   
 | | |     |   | |     |   | | |   |     |     |   |   | +---------------+ |   |     | |     | | | |       | | | | |     |       | | |     | |     | | |           | | |     |       | | |   | | |   |   
 | | |     |   | |     |   | | |   |     |     |   |   |   | | |     | |   |   |     | |     | | | |       | | | | |     |       | | |     | |     | | |           | | |     |       | | |   | | |   |   
 | | |     |   | |     |   | | | +-+     |     |   |   |   | +---------|---|---------|-------|-|-|-|-------|-|---|-|-----------------|-------+     | | |           | | |     |       | | |   | | |   |   
 | | |     |   | |     |   | | | |       |     |   |   |   |   |     | |   |   |     | |     | | | |       | | | | |     |       | | |     |       | | |           | | |     |       | | |   | | |   |   
 | | |     |   | |     | +---|-|---------|-----|-----------|---|---------------|-----|-----------|-|-------|-----|-----------------|-|-----|---------------------------+     |       +-------|-|-+   |   
 | | |     |   | |     | | | | | |       |     |   |   |   |   |     | |   |   |     | |     | | | |       | | | | |     |       | | |     |       | | |           | |       |         | |   | |     |   
 | | |     |   | |     | +---|-|-|-+ +---------|---|-----------|-----|-|-------------|-------|-|---|---------|-|-|-|-------------|---------+       | | |   +-------|-|-----------------|-|-+ | |     |   
 | | |     |   | |     |   | | | | | |   |     |   |   |   |   |     | |   |   |     | |     | | | |       | | | | |     |       | | |             | | |   |       | |       |         | | | | |     |   
 | | |     |   | +-+   | +-----|-+ | |   |     +---|-------|---+     | |   |   | +---|-|-------+ | |       | | | | |     |       | | |     +-------|-|-----|---------------------------------|-|-+   |   
 | | |     |   |   |   | | | | |   | |   |         |   |   |         | |   |   | |   | |     |   | |       | | | | |     |       | | |     |       | | |   |       | |       |         | | | | | |   |   
 | | |     |   |   |   | +-|-|---------------+     |   |   |         | |   |   | |   | |     |   | |     +---|---|-------|-------|-|---------------|---------------|---------|---------|-----------+ |   
 | | |     |   |   |   |   | | |   | |   |   |     |   |   |         | |   |   | |   | |     |   | |     | | | | | |     |       | | |     |       | | |   |       | |       |         | | | | | | | |   
 | | |     +-------------+ | | | +---------------------|---------+   | |   |   | |   | |     |   | | +-----|-----|-------|-------|-|-|-----|---------|-|-------------+       |         | | | | | +---|-+ 
 | | |         |   |   | | | | | | | |   |   |     |   |   |     |   | |   |   | |   | |     |   | | |   | | | | | |     |       | | |     |       | | |   |       |         |         | | | | |   | | | 
 | | | +-------|---------|---|-------|---------------------------|---|-|---------|-+ | |     |   | | |   | | | | | |     |   +---|-|-|-------------|---|---------------------|---+     | | | | |   | | | 
 | | | |       |   |   | | | | | | | |   |   |     |   |   |     |   | |   |   | | | | |     |   | | |   | | | | | |     |   |   | | |     |       | | |   |       |         |   |     | | | | |   | | | 
 | | | |   +---------------------|---|-------|---------+   |   +-|-+ +-----|-------|---|-----------|---------|-----|---+ |   |   | | |     |       | | |   |       |         |   |     | | | | +-+ | | | 
 | | | |   |   |   |   | | | | | | | |   |   |     |       |   | | |   |   |   | | | | |     |   | | |   | | | | | |   | |   |   | | |     |       | | |   |       |         |   |     | | | |   | | | | 
 +-|-------+   |   |   | | | | | | | |   |   |   +-|-------+   | | |   |   |   | | | | |     |   | | |   | | | | | |   | |   |   | | |     |       | | |   |       |         |   |     | | | |   | | | | 
   | | |       |   |   | | | | | | | |   |   |   | |           | | |   |   |   | | | | |     |   | | |   | | | | | |   | |   |   | | |     |       | | |   |       |         |   |     | | | |   | | | | 
   | | |       |   |   | | | | | | | |   |   |   | | +---------|-|-|-------|---|-------|-----|-----|-|-----|-|-+ | |   | |   |   | | |     |       | | |   |       |         |   |     | | | |   | | | | 
   | | |       |   |   | | | | | | | |   |   |   | | |         | | |   |   |   | | | | |     |   | | |   | | |   | |   | |   |   | | |     |       | | |   |       |         |   |     | | | |   | | | | 
   | | |       |   |   | | | | | | | |   |   |   | | |         | | |   |   |   | | | | |     |   | | +-----|-+   | |   | |   |   | | |     |       | | |   |       |         |   |     | | | |   | | | | 
   | | |       |   |   | | | | | | | |   |   |   | | |         | | |   |   |   | | | | |     |   | |     | |     | |   | |   |   | | |     |       | | |   |       |         |   |     | | | |   | | | | 
   | | |       |   |   | | | | | | | |   |   |   | | |         | | |   | +-|---|-----|-|---------+ |     | |     | |   | +---|-------------|---+   | | |   |       |     +-+ |   |     | | | |   | | | | 
   | | |       |   |   | | | | | | | |   |   |   | | |         | | |   | | |   | | | | |     |     |     | |     | |   |     |   | | |     |   |   | | |   |       |     | | |   |     | | | |   | | | | 
   | | |       +---|---|-----|-------|-------------|-----------+ | | +-----+   | | | | |     |     |     | |     +-|---|-----|---|-|---------------|-|-------------|-------------------+ | | | +-----|-+ 
   | | |           |   | | | | | | | |   |   |   | | |           | | | | |     | | | | |     |     |     | |       |   |     |   | | |     |   |   | | |   |       |     | | |   |       | | | | | | |   
   | | |           |   | | +-|---|---------------|---------------|---|-------------|-|-|-----|-----|-----|-|-----------|---------|-+ |     |   +-----|-----|-------|-------|-----------------|-|---|-|-+ 
   | | |           |   | |   | | | | |   |   |   | | |           | | | | |     | | | | |     |     |     | |       |   |     |   |   |     |       | | |   |       |     | | |   |       | | | | | | | | 
 +-|-|-------------|---------|---|-------|---|-+ | | |           | | | | |     | | | | |     |     |     | | +-----|-----------------|-----|---------|-|---|-+     |     | | |   |       | | | | | | | | 
 | | | |           |   | |   | | | | |   |   | | | | |           | | | | |     | | | | |     |     |     | | |     |   |     |   |   |     |       | | |   | |     |     | | |   |       | | | | | | | | 
 | | | |           |   | |   | | | | | +-----|---|-----------------|-------------|-|---|-----|-----|-------|-|---------------|---|---------+       | | |   | |     |     | | |   |       | | | | | | | | 
 | | | |           |   | |   | | | | | | |   | | | | |           | | | | |     | | | | |     |     |     | | |     |   |     |   |   |             | | |   | |     |     | | |   |       | | | | | | | | 
 | | | +-----------------|-------|---|-+ |   | | | +-|---------+ | | | | |     | | | | |     |     +-----|-|-------|---|-----|-----------------------|-|---|-|-----|-------|-|---|-------------|-|-+ | | 
 | | |             |   | |   | | | | |   |   | | |   |         | | | | | |     | | | | |     |           | | |     |   |     |   |   |             | | |   | |     |     | | |   |       | | | | |   | | 
 +-|-------------+ |   | | +-+ +-|---|---------|-|---|-----------|---|---+     | | | | |     |           | | |     |   |     | +-|-----------------|---|---|---------------|-|-----------|-|-|-|---+ | | 
   | |           | |   | | |     | | |   |   | | |   |         | | | | |       | | | | |     |           | | |     |   |     | | |   |             | | |   | |     |     | | |   |       | | | | | | | | 
   | |     +-----|-----|-|-|-----|-|-|--W--------------------------------------|-------------|-----------|-|-----------------+ | |   |             | | |   | |     |     | | |   |       | | | | | | | | 
   | |     |     | |   | | |     | | |   |   | | |   |         | | | | |       | | | | |     |           | | |     |   |       | |   |             | | |   | |     P     | | |   |       | | | | | | | | 
   | |     | +---|-|---|---------|-|-----------|-----|---------+ | | | |   +-----|-|-----------------+   | | +-----|-----+     | |   |             | | |   | +-------------|-+   |       | | | | | | | | 
   | |     | |   | |   | | |     | | |   |   | | |   |           | | | |   |   | | | | |     |       |   | |       |   | |     | |   |             | | |   |       |     | |     |       | | | | | | | | 
   | |     | |   | |   | | |     | +-|-------|-----+ |           | | | |   |   | | | | |     |       |   | |       |   | |     | |   |             | | |   |       |     | |     |       | | | | | | | | 
   | |     | |   | |   | | |     |   |   |   | | | | |           | | | |   |   | | | | |     |       |   | |       |   | |     | |   |             | | |   |       |     | |     |       | | | | | | | | 
 +-+ +-+   | |   | |   | | |     |   |   |   | | | | |       +-+ +-------------|-|-|-|---------------------|-------------|-------|---|-----------+ | | |   |       |     | |     |       | | | | | | | | 
 |     |   | |   | |   | | |     |   |   |   | | | | |       | |   | | |   |   | | | | |     |       |   | |       |   | |     | |   |           | | | |   |       |     | |     |       | | | | | | | | 
 |     |   | | +---|-----|-|-------------------|-|-|-|-------|-------|-----|---|---|---------------------|-|---------+ | +-+   | |   |           | | | |   |   +-----+   | |     | +-----+ | | | | | | | 
 |     |   | | | | |   | | |     |   |   |   | | | | |       | |   | | |   |   | | | | |     |       |   | |       | | |   |   | |   |           | | | |   |   |   | |   | |     | |       | | | | | | | 
 |     |   | | | | |   | | |     |   |   |   | | | | |       | |   | | |   |   | | +---+     |       |   | |       | | |   |   | |   |           | | | |   |   |   | |   | |     | |       | | | | | | | 
 |     |   | | | | |   | | |     |   |   |   | | | | |       | |   | | |   |   | |   |       |       |   | |       | | |   |   | |   |           | | | |   |   |   | |   | |     | |       | | | | | | | 
 | +---|---------|-----|-|-|---------|---|---|---|---|-------|-|---|-|---------|-----|-----------------------------|---+   +---|-----|---------------|-|-------|-----------------|---------|-|-+ | | | | 
 | |   |   | | | | |   | | |     |   |   |   | | | | |       | |   | | |   |   | |   |       |       |   | |       | |         | |   |           | | | |   |   |   | |   | |     | |       | |   | | | | 
 | |   |   | | | | |   | | |     |   |   |   | | +---|---------------------|---|-|---|-------------+ |   | |     +-|-----------------------------------|---|---|-----|---------+ | |       | |   | | | | 
 | |   |   | | | | |   | | |     |   |   |   | |   | |       | |   | | |   |   | |   |       |     | |   | |     | | |         | |   D           | | | |   |   |   | |   | |   | | |       | |   | | | | 
 | +-------|---|---|-----|-----------|-------|-|---+ |       | |   | | |   |   +-+   |       |     | |   | |     | | |         | |   |           | | | |   |   |   | +---|-|-----|-+       | |   | | | | 
 |     |   | | | | |   | | |     |   |   |   | |     |       | |   | | |   |         |       |     | |   | |     | | |         | |   |           | | | |   |   |   |     | |   | |         | |   | | | | 
 |     |   | | | | |   | | +-----|-------|---|-|-----|-------|-|-+ +---+   +-----------------|-------|-----|-----|-+ |         | |   |           | | | |   |   |   |   +-+ | +-|-|-----------------|---+ 
 |     |   | | | | |   | |       |   |   |   | |     |       | | |   |               |       |     | |   | |     |   |         | |   |           | | | |   |   |   |   |   | | | |         | |   | | |   
 | +-------|-|-|-|-----|---------|-------|-----|---------------|-|-------------------|-------|-----|-|---------------|---------------|-------------------------|-------|---|-|-|-|---------------|-+ |   
 | |   |   | | | | |   | |       |   |   |   | |     |       | | |   |               |       |     | |   | |     |   |         | |   |           | | | |   |   |   |   |   | | | |         | |   |   |   
 | |   +-----|-|-----+ | |   +---|---|---|-----|-------------|-|-----------------------------|-----------|-|-----|---|---------------------------|-----|-------|---|-------+ | | |         | |   +---+   
 | |       | | | | | | | |   |   |   |   |   | |     |       | | |   |               |       |     | |   | |     |   |         | |   |           | | | |   |   |   |   |     | | |         | |           
 | |       +-+ | | | | | |   |   |   |   |   | |     |       | | +---|---------------|-------------+ |   | |     |   |         | |   |           | | | |   |   |   |   |     | | |         | |           
 | |           | | | | | |   |   |   |   |   | |     |       | |     |               |       |       |   | |     |   |         | |   |           | | | |   |   |   |   |     | | |         | |           
 | |           | | | | | |   |   |   |   |   | |     |   +---|------C----------------|---------------+   | |     |   |         | |   |           | | | |   |   |   |   |     | | |         | |           
 | |           | | | | | |   |   |   |   |   | |     |   |   | |     |               |       |           | |     |   |         | |   |           | | | |   |   |   |   |     | | |         | |           
 | |           | | | | | |   |   |   |   |   | |     |   |   | |     |               |       |           | |     |   |         | |   |           | | | |   |   |   |   |     | | |         | |           
 | |           | | | | | |   |   |   |   |   | |     |   |   | |     |               |       |           | |     |   |         | |   |           | | | |   |   |   |   |     | | |         | |           
 | |           | | | | | |   |   |   |   |   | |     |   |   | |     |               |       |           | |     |   |         | |   |           | | | |   |   |   |   |     | | |         | |           
 | |           | | | | | |   |   |   |   |   | |     |   |   | |     |               |       |           | |     |   |         | |   |           | | | |   |   |   |   |     | | |         | |           
 | |           | | | | | |   |   |   |   |   +-|---------|-----------+               |       |           | |     |   |         | |   |           | | | |   |   |   |   |     | | |         | |           
 | |           | | | | | |   |   |   |   |     |     |   |   | |                     |       |           | |     |   |         | |   |           | | | |   |   |   |   |     | | |         | |           
 | |       +---|-----|---|---|-----------|---+ |     |   |   | |                     |       |           | |     |   +---------|-|---------------|-|-----------|---+   |     | | |         | |           
 | |       |   | | | | | |   |   |   |   |   | |     |   |   | |                     |       |           | |     |             | |   |           | | | |   |   |       |     | | |         | |           
 | |       |   | +-|-|---|---|---|---|---|---|-------|---|-----|-----+               |       |           | |     |             | |   +-----------------------------------------|-----------|-|-----+ +-+ 
 | |       |   |   | | | |   |   |   |   |   | |     |   |   | |     |               |       |           | |     |             | |               | | | |   |   |       |     | | |         | |     | | | 
 | |       |   |   | | | |   |   |   |   |   | |     |   |   | |     +-------------------------------------|-------------------|---------+       | | | | +-----|-----------------+         | |     | | | 
 | |       |   |   | | | |   |   |   |   |   | |     |   |   | |                     |       |           | |     |             | |       |       | | | | | |   |       |     | |           | |     | | | 
 | |       |   |   | | | |   | +-|---|-------|-|---------|---------+         +-----+ |       |           | |     |             | |       |       | | | | | |   |       |     | |           | |     +-+ | 
 | |       |   |   | | | |   | | |   |   |   | |     |   |   | |   |         |     | |       |           | |     |             | |       |       | | | | | |   |       |     | |           | |         | 
 | |       |   | +---|-|-----|-----------|---|---+   |   |   | |   |         |     | |       |           | |     |             | |       |       | | +-----------------|-------------------|-|---------+ 
 | |       |   | | | | | |   | | |   |   |   | | |   |   |   | |   |         |     | |       |           | |     |             | |       |       | |   | | |   |       |     | |           | |           
 | |       |   | | | | | |   | | |   +---|---|---|---+ +-------+   |         |     | |       |           | |     |             | |       |       | |   | | |   |       |     | |           | +-----+     
 | |       |   | | | | | |   | | |       |   | | |     | |   |     |         |     | |       |           | |     |             | |       |       | |   | | |   |       |     | |           |       |     
 | |       |   | | | | | |   | | |       |   | | |     | |   |     |         |     | |       |           | |     |             | |       |       | |   | | |   |       |     | |           |       |     
 | |       |   | | | | | |   | | |       |   | | |     | |   |     |         |     | |       |           | |     |             | |       |       | |   | | |   |       |     | |           |       |     
 | |       |   | | | | | |   | | |       |   | | |     | |   |     |         |     | |       |           | |     +---------------|---------------|-|-------------------|-----+ |           |       |     
 | |       |   | | | | | |   | | |       |   | | |     | |   |     |         |     | |       |           | |                   | |       |       | |   | | |   |       |       |           |       |     
 | |       |   | | | | | |   | | |       |   +-+ +-----|-----|-------------------------------------+     | |     +---------------|---------------|-----|-----+ |       |       |           |       |     
 | |       |   | | | | | |   | | |       |             | |   |     |         |     | |       |     |     | |     |             | |       |       | |   | | | | |       |       |           |       |     
 | |       |   | | | | | |   | | |       |             | |   |     |         |     | |       |     |     | |     |             | |       |       | |   | | | | |       |       |           |       | +-+ 
 | |       |   | | | | | |   | | |       |             | |   |     |         |     | |       |     |     | |     |             | |       |       | |   | | | | |       |       |           |       | | | 
 +-|-------|---|-------|-|-------|-------|-------------|-|---|-----|---------|-------|-------|-----|-------------|-------------|-|-----------------|-----|-|-----------|---+   |     +-------------+ | | 
   |       |   | | | | | |   | | |       |             | |   |     |         |     | |       |     |     | |     |             | |       |       | |   | | | | |       |   |   |     |     |         | | 
   |       |   | | | | | |   | | |       |             | | +-|---------------------|-|-------------|-------|-----|-------------+ |       |       | |   | | | | |       |   |   |     |     |         | | 
   |       |   | | | | | |   | | |       |             | | | |     |         |     | |       |     |     | |     |               |       |       | |   | | | | |       |   |   |     |     |         | | 
   |   +-------|---|-|---|---|---|-------|-------+     | | | |     |         |     | |       |     |     | |     |               |       |       | |   +-|-----|-----------|---|-----+     |         | | 
   |   |   |   | | | | | |   | | |       |       |     | | | |     |         |     | |       |     |     | |     |               |       |       | |     | | | |       K   |   |           |         | | 
   |   |   |   +---+ +-|-|---|---|---------------|-----|-|---|---------------|---------------------|-----|-------|-----------------------|-+     | |     | | | |       |   |   | +-----------------+ | | 
   |   |   |     |     | |   | | |       |       |     | | | |     |         |     | |       |     |     | |     |               |       | |     | |     | | | |       |   |   | |         |       | | | 
   |   |   |   +-----------------|-------------+ |     | | | | +-------------|-----|-|-------|-----|---+ | |     |               |       | |     | |     | | | +-------|-------|-----------+       | | | 
   |   |   |   | |     | |   | | |       |     | |     | | | | |   |         |     | |       |     |   | | |     |               |       | |     | |     | | |         |   |   | |                 | | | 
   |   |   |   | |   +---|-------|-------|-------------|-|-|-------|-----------------|-------|-----|-------|-----------------------------|---------+     | | |         |   |   | |                 | | | 
   |   |   |   | |   | | |   | | |       |     | |     | | | | |   |         |     | |       |     |   | | |     |               |       | |     |       | | |         |   |   | |                 | | | 
   |   |   |   | |   | | |   | | |       |     | |     | +-----------------+ |     | |       |     |   | | |     |               |       +---------------|-------------+   |   | |                 | | | 
   |   |   |   | |   | | |   | | |       |     | |     |   | | |   |       | |     | |       |     |   | | |     |               |         |     |       | | |             |   | |                 | | | 
   |   |   |   | |   | | |   | | |       |     | |     |   | | |   |       | |     | |     +-|---------|-|-|-----|----G----------|-------+ |     |       | +-------+       +-----------------------+ | | 
   |   |   |   | |   | | |   | | |       |     | |     |   | | |   |       | |     | |     | |     |   | | |     |               |       | |     |       |   |     |           | |                   | | 
   |   |   |   | +-----|-------|---------|-------------|---|-|-------------|-------|-|-------|-----|-----|-+     +---------------|-----------------------|---|-----|-----------|-|-----------------+ | | 
   |   |   |   |     | | |   | | |       |     | |     |   | | |   |       | |     | |     | |     |   | |                       |       | |     |       |   |     |           | |                 | | | 
   |   |   |   |     | | |   | | |     +-|-------+ +---+ +-|-|-|-----------|-|-----+ +-----|-|---------|-------------------------|-------|-------|-----+ |   |     |           | |                 | | | 
   |   |   |   |     | | |   | | |     | |     |   |     | | | |   |       | |             | |     |   | |                       |       | |     |     | |   |     |           | |                 | | | 
   |   |   |   |     | | |   +-|-------------------------|-----|---|---------|---------------------|---|-+                       |       +-|---------+ | |   |     |           | |                 | | | 
   |   |   |   |     | | |     | |     | |     |   |     | | | |   |       | |             | |     |   |                         |         |     |   | | |   |     |           | |                 | | | 
   |   |   |   |     | | |     | |     | +---------|-------|-|-|---+       | |             | |     |   |                         |         |     |   | | |   |     |           | |                 | | | 
   |   |   |   |     | | |     | |     |       |   |     | | | |           | |             | |     |   |                         |         |     |   | | |   |     |           | |                 | | | 
   | +-|---|---+     +-|-|-----|-|-----|-------|-+ |   +-|-------------------|-------------+ |     |   |                         +---------|-----|---|-------------|-----------+ |                 | | | 
   | | |   |           | |     | |     |       | | |   | | | | |           | |               |     |   |                                   |     |   | | |   |     |             |                 | | | 
   | | |   +---------+ | |     | |     +-----------|-----|---|-------------------------------|---------|---+                               |     |   | | |   |     |             |                 | | | 
   | | |             | | |     | |             | | |   | | | | |           | |               |     |   |   |                               |     |   | | |   |     |             |                 | | | 
   | | |             | | |     | |             | +-|---|-|-----|-------------|-----------------+   |   +-------------------------------------+   |   | | +---|-----|-------------|-----+           | | | 
   | | |             | | |     | |             |   |   | | | | |           | |               | |   |       |                               | |   |   | |     |     |             |     |           | | | 
   | | |             | | |   +-+ +---------------------|-------|-----------|-----------------|-|---|-------+                               | |   |   | |     |     |             |     |           | | | 
   | | |             | | |   |                 |   |   | | | | |           | |               | |   |                                       | |   |   | |     |     |             |     |           | | | 
   | | |             | | +-------------------------|---|-|-|-|-------------|---------------------------------------------------------------------|---|-+     |     | +-----------|-----+           | | | 
   | | |             | |     |                 |   |   | | | | |           | |               | |   |                                       | |   |   |       |     | |           |                 | | | 
   | | |             +-----+ | +-----------------------|---|-|-|-----------|-----------------|-|---|---------------------------------------------+   |       +-------+           |                 | | | 
   | | |               |   | | |               |   |   | | | | |           | |               | |   |                                       | |       |             |             |                 | | | 
   | | |               |   | +-|---+         +---------|-|-|---------------------------------|-|---|---------------------------------------|-------------------------------------|-----------------|---+ 
   | | |               |   |   |   |         | |   |   | | | | |           | |               | |   |                                       | |       |             |             |                 | |   
   | | |               +-------|---|---------|-----|-----|-+ | +-+ +---------|-----------------|---|---------------------------------------------------------------|---+         |         +-----+ | |   
   | | |                   |   |   |         | |   |   | |   |   | |       | |               | |   |                                       | |       |             |   |         |         |     | | |   
 +---|-------------------------|-------------|-----|-----|---|-----|---------------------------+   |                                       | |       |             |   +-------------------+     +-|-|-+ 
 | | | |                   |   |   |         | |   |   | |   |   | |       | |               |     |                                       | |       |             |             |                 | | | 
 | | | |                   |   |   +---------|-|---|-----------------------|-|---------------|-----|-------------------------------------------------+ +-----------|-------------+           +-----|---+ 
 | | | |                   |   |             | |   |   | |   |   | |       | |               |     |                                       | |         |           |                         |     | |   
 | | | |                   |   |             | |   | +-+ |   | +-|-|-------------------------------|---------------------------------------------------|-------------------------------------+     | |   
 | | | |                   |   |             | |   | |   |   | | | |       | |               |     |                                       | |         |           |                               | |   
 | | | |               +---------------------+ |   | |   |   | +-+ +-------|-+               +-----------------------------------------------|---------------------------------+                   | |   
 | | | |               |   |   |               |   | |   |   |             |                       |                                       | |         |           |           |                   | |   
 | +-+ | +-------------+   +---+               +---+ +---+   +-------------+                       +---------------------------------------------------+           |           +-------------------|-+   
 |     | |                                                                                                                                 | |                     |                               |     
 +-----+ +---------------------------------------------------------------------------------------------------------------------------------+ +---------T           +-------------------------------+     
                                                                                                                                                                                                         
'''

test ='''
.
     |          
     |  +--+    
     A  |  C    
 F---|----E|--+ 
     |  |  |  D 
     +B-+  +--+ 
'''

class Solver
	constructor: ( @input )->
		@map = @input.split '\n'
		@map.shift() if @map[0][0] is '.'
		return

	solve1: ->
		y = 0
		x = @map[0].indexOf '|'
		dx = 0
		dy = 1
		out = ''
		steps = 1
		loop
			x+=dx
			y+=dy
			c=@map[y][x]
			# _log x, y, c
			switch c
				when ' ', undefined, null
					_log.darkGray 'path end', x, y, dx, dy, "'#{c}'"
					return out + ':' + steps
				when '|', '-'
					break # does nothing
				when '+'
					[dx,dy]=[dy,dx]
					if (@map[y+dy]?[x+dx] ? ' ') is ' '
						dx = -dx
						dy = -dy
				else
					out = out + c
			++steps
		_log.red 'this should never execute'
		return

	solve2: ->

verify = ( ex, inp )->
	s = new Solver inp[0]
	for ev, i in ex
		if ev is v=s["solve#{i+1}"] inp[1..]...
			_log.cyan v
		else
			_log.red 'expected', ev, 'actual', v
	return

do ->
	try
		verify ['ABCDEF:38'], [test]

		s = new Solver input
		_log.yellow s.solve1()

	catch e
		_log.red e
	return
